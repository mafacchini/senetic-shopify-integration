name: 🔄 Senetic Import Automatico

on:
  schedule:
    - cron: '0 2 * * *'
  workflow_dispatch:
    inputs:
      force_import:
        description: 'Forza import'
        required: false
        default: 'false'
        type: boolean

jobs:
  import-products:
    runs-on: ubuntu-latest
    
    steps:
    - name: 📦 Checkout Repository
      uses: actions/checkout@v4
      
    - name: 🟢 Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: 'app-senetic-shopify/package-lock.json'  # ⬅️ AGGIUNTO!
        
    - name: 📥 Install Dependencies
      working-directory: app-senetic-shopify  # ⬅️ CAMBIATO!
      run: npm ci
        
    - name: 🔄 Run Senetic Import
      working-directory: app-senetic-shopify  # ⬅️ CAMBIATO!
      env:
        SENETIC_AUTH: ${{ secrets.SENETIC_AUTH }}
        SHOPIFY_STORE_URL: ${{ secrets.SHOPIFY_STORE_URL }}
        SHOPIFY_ACCESS_TOKEN: ${{ secrets.SHOPIFY_ACCESS_TOKEN }}
        FORCE_IMPORT: ${{ github.event.inputs.force_import || 'false' }}
      run: node src/scripts/auto-import.js
        
    - name: 📊 Upload Import Results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: import-results-${{ github.run_number }}
        path: app-senetic-shopify/logs/
        retention-days: 30