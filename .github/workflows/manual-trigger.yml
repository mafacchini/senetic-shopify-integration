name: 🎮 Manual Import Trigger

on:
  workflow_dispatch:
    inputs:
      import_type:
        description: 'Tipo di import'
        required: true
        default: 'standard'
        type: choice
        options:
          - standard
          - force
          - test
      max_products:
        description: 'Massimo numero di prodotti'
        required: false
        default: '10'
        type: string

jobs:
  manual-import:
    runs-on: ubuntu-latest
    
    steps:
    - name: 📦 Checkout Repository
      uses: actions/checkout@v4
      
    - name: 🟢 Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: 'app-senetic-shopify/package-lock.json'  # ⬅️ AGGIUNTO!
        
    - name: 📥 Install Dependencies
      working-directory: app-senetic-shopify  # ⬅️ CAMBIATO!
      run: npm ci
        
    - name: 🎮 Run Manual Import
      working-directory: app-senetic-shopify  # ⬅️ CAMBIATO!
      env:
        SENETIC_AUTH: ${{ secrets.SENETIC_AUTH }}
        SHOPIFY_STORE_URL: ${{ secrets.SHOPIFY_STORE_URL }}
        SHOPIFY_ACCESS_TOKEN: ${{ secrets.SHOPIFY_ACCESS_TOKEN }}
        IMPORT_TYPE: ${{ github.event.inputs.import_type }}
        MAX_PRODUCTS: ${{ github.event.inputs.max_products }}
      run: |
        echo "🎮 Import manuale avviato"
        echo "📊 Tipo: $IMPORT_TYPE"
        echo "📦 Max prodotti: $MAX_PRODUCTS"
        node src/scripts/auto-import.js
        
    - name: 📊 Display Results
      if: always()
      working-directory: app-senetic-shopify  # ⬅️ CAMBIATO!
      run: |
        echo "📋 Risultati import:"
        if [ -f logs/import-*.log ]; then
          tail -20 logs/import-*.log
        fi