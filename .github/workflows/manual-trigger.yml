name: ðŸŽ® Manual Import Trigger

on:
  workflow_dispatch:
    inputs:
      import_type:
        description: 'Tipo di import'
        required: true
        default: 'standard'
        type: choice
        options:
          - standard
          - force
          - test
      max_products:
        description: 'Massimo numero di prodotti (default: 10)'
        required: false
        default: '10'
        type: string
      categories:
        description: 'Categorie da importare (separate da virgola)'
        required: false
        default: 'Sistemi di sorveglianza,Reti'
        type: string

jobs:
  manual-import:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¦ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ðŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: 'app-senetic-shopify/package-lock.json'
        
    - name: ðŸ“¥ Install Dependencies
      working-directory: app-senetic-shopify
      run: npm ci
        
    - name: ðŸŽ® Run Manual Import
      working-directory: app-senetic-shopify
      env:
        SENETIC_AUTH: ${{ secrets.SENETIC_AUTH }}
        SHOPIFY_STORE_URL: ${{ secrets.SHOPIFY_STORE_URL }}
        SHOPIFY_ACCESS_TOKEN: ${{ secrets.SHOPIFY_ACCESS_TOKEN }}
        IMPORT_TYPE: ${{ github.event.inputs.import_type }}
        MAX_PRODUCTS: ${{ github.event.inputs.max_products }}
        CATEGORIES: ${{ github.event.inputs.categories }}
      run: |
        echo "ðŸŽ® Import manuale avviato"
        echo "ðŸ“Š Tipo: $IMPORT_TYPE"
        echo "ðŸ“¦ Max prodotti: $MAX_PRODUCTS"
        echo "ðŸ“‹ Categorie: $CATEGORIES"
        node src/scripts/auto-import.js
        
    - name: ðŸ“Š Display Results
      if: always()
      working-directory: app-senetic-shopify
      run: |
        echo "ðŸ“‹ Risultati import:"
        if [ -f logs/import-*.log ]; then
          tail -20 logs/import-*.log
        fi